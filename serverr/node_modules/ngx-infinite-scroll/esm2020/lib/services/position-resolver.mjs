export function createResolver({ windowElement, axis, }) {
    return createResolverWithContainer({ axis, isWindow: isElementWindow(windowElement) }, windowElement);
}
export function createResolverWithContainer(resolver, windowElement) {
    const container = resolver.isWindow || (windowElement && !windowElement.nativeElement)
        ? windowElement
        : windowElement.nativeElement;
    return { ...resolver, container };
}
export function isElementWindow(windowElement) {
    const isWindow = ['Window', 'global'].some((obj) => Object.prototype.toString.call(windowElement).includes(obj));
    return isWindow;
}
export function getDocumentElement(isContainerWindow, windowElement) {
    return isContainerWindow ? windowElement.document.documentElement : null;
}
export function calculatePoints(element, resolver) {
    const height = extractHeightForElement(resolver);
    return resolver.isWindow
        ? calculatePointsForWindow(height, element, resolver)
        : calculatePointsForElement(height, element, resolver);
}
export function calculatePointsForWindow(height, element, resolver) {
    const { axis, container, isWindow } = resolver;
    const { offsetHeightKey, clientHeightKey } = extractHeightPropKeys(axis);
    // scrolled until now / current y point
    const scrolled = height +
        getElementPageYOffset(getDocumentElement(isWindow, container), axis, isWindow);
    // total height / most bottom y point
    const nativeElementHeight = getElementHeight(element.nativeElement, isWindow, offsetHeightKey, clientHeightKey);
    const totalToScroll = getElementOffsetTop(element.nativeElement, axis, isWindow) +
        nativeElementHeight;
    return { height, scrolled, totalToScroll, isWindow };
}
export function calculatePointsForElement(height, element, resolver) {
    const { axis, container } = resolver;
    // perhaps use container.offsetTop instead of 'scrollTop'
    const scrolled = container[axis.scrollTopKey()];
    const totalToScroll = container[axis.scrollHeightKey()];
    return { height, scrolled, totalToScroll, isWindow: false };
}
export function extractHeightPropKeys(axis) {
    return {
        offsetHeightKey: axis.offsetHeightKey(),
        clientHeightKey: axis.clientHeightKey(),
    };
}
export function extractHeightForElement({ container, isWindow, axis, }) {
    const { offsetHeightKey, clientHeightKey } = extractHeightPropKeys(axis);
    return getElementHeight(container, isWindow, offsetHeightKey, clientHeightKey);
}
export function getElementHeight(elem, isWindow, offsetHeightKey, clientHeightKey) {
    if (isNaN(elem[offsetHeightKey])) {
        const docElem = getDocumentElement(isWindow, elem);
        return docElem ? docElem[clientHeightKey] : 0;
    }
    else {
        return elem[offsetHeightKey];
    }
}
export function getElementOffsetTop(elem, axis, isWindow) {
    const topKey = axis.topKey();
    // elem = elem.nativeElement;
    if (!elem.getBoundingClientRect) {
        // || elem.css('none')) {
        return;
    }
    return (elem.getBoundingClientRect()[topKey] +
        getElementPageYOffset(elem, axis, isWindow));
}
export function getElementPageYOffset(elem, axis, isWindow) {
    const pageYOffset = axis.pageYOffsetKey();
    const scrollTop = axis.scrollTopKey();
    const offsetTop = axis.offsetTopKey();
    if (isNaN(window.pageYOffset)) {
        return getDocumentElement(isWindow, elem)[scrollTop];
    }
    else if (elem.ownerDocument) {
        return elem.ownerDocument.defaultView[pageYOffset];
    }
    else {
        return elem[offsetTop];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb24tcmVzb2x2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtaW5maW5pdGUtc2Nyb2xsL3NyYy9saWIvc2VydmljZXMvcG9zaXRpb24tcmVzb2x2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBVUEsTUFBTSxVQUFVLGNBQWMsQ0FBQyxFQUM3QixhQUFhLEVBQ2IsSUFBSSxHQUNjO0lBQ2xCLE9BQU8sMkJBQTJCLENBQ2hDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxlQUFlLENBQUMsYUFBYSxDQUFDLEVBQUUsRUFDbEQsYUFBYSxDQUNkLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLDJCQUEyQixDQUN6QyxRQUFhLEVBQ2IsYUFBMkI7SUFFM0IsTUFBTSxTQUFTLEdBQ2IsUUFBUSxDQUFDLFFBQVEsSUFBSSxDQUFDLGFBQWEsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUM7UUFDbEUsQ0FBQyxDQUFDLGFBQWE7UUFDZixDQUFDLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQztJQUNsQyxPQUFPLEVBQUUsR0FBRyxRQUFRLEVBQUUsU0FBUyxFQUFFLENBQUM7QUFDcEMsQ0FBQztBQUVELE1BQU0sVUFBVSxlQUFlLENBQUMsYUFBMkI7SUFDekQsTUFBTSxRQUFRLEdBQUcsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUUsQ0FDekQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FDNUQsQ0FBQztJQUNGLE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQ2hDLGlCQUEwQixFQUMxQixhQUFrQjtJQUVsQixPQUFPLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsUUFB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QU07UUFDTCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztLQUM5QjtBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsbUJBQW1CLENBQ2pDLElBQWtCLEVBQ2xCLElBQWtCLEVBQ2xCLFFBQWlCO0lBRWpCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUM3Qiw2QkFBNkI7SUFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFBRTtRQUMvQix5QkFBeUI7UUFDekIsT0FBTztLQUNSO0lBQ0QsT0FBTyxDQUNMLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLE1BQU0sQ0FBQztRQUNwQyxxQkFBcUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUM1QyxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxxQkFBcUIsQ0FDbkMsSUFBa0IsRUFDbEIsSUFBa0IsRUFDbEIsUUFBaUI7SUFFakIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzFDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN0QyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFFdEMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1FBQzdCLE9BQU8sa0JBQWtCLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0tBQ3REO1NBQU0sSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1FBQzdCLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7S0FDcEQ7U0FBTTtRQUNMLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0tBQ3hCO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgQ29udGFpbmVyUmVmLFxuICBJUG9zaXRpb25FbGVtZW50cyxcbiAgSVBvc2l0aW9uU3RhdHMsXG4gIElSZXNvbHZlcixcbn0gZnJvbSAnLi4vLi4vbW9kZWxzJztcbmltcG9ydCB7IEF4aXNSZXNvbHZlciB9IGZyb20gJy4vYXhpcy1yZXNvbHZlcic7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZXNvbHZlcih7XG4gIHdpbmRvd0VsZW1lbnQsXG4gIGF4aXMsXG59OiBJUG9zaXRpb25FbGVtZW50cyk6IElSZXNvbHZlciB7XG4gIHJldHVybiBjcmVhdGVSZXNvbHZlcldpdGhDb250YWluZXIoXG4gICAgeyBheGlzLCBpc1dpbmRvdzogaXNFbGVtZW50V2luZG93KHdpbmRvd0VsZW1lbnQpIH0sXG4gICAgd2luZG93RWxlbWVudFxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUmVzb2x2ZXJXaXRoQ29udGFpbmVyKFxuICByZXNvbHZlcjogYW55LFxuICB3aW5kb3dFbGVtZW50OiBDb250YWluZXJSZWZcbikge1xuICBjb25zdCBjb250YWluZXIgPVxuICAgIHJlc29sdmVyLmlzV2luZG93IHx8ICh3aW5kb3dFbGVtZW50ICYmICF3aW5kb3dFbGVtZW50Lm5hdGl2ZUVsZW1lbnQpXG4gICAgICA/IHdpbmRvd0VsZW1lbnRcbiAgICAgIDogd2luZG93RWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICByZXR1cm4geyAuLi5yZXNvbHZlciwgY29udGFpbmVyIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0VsZW1lbnRXaW5kb3cod2luZG93RWxlbWVudDogQ29udGFpbmVyUmVmKTogYm9vbGVhbiB7XG4gIGNvbnN0IGlzV2luZG93ID0gWydXaW5kb3cnLCAnZ2xvYmFsJ10uc29tZSgob2JqOiBzdHJpbmcpID0+XG4gICAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHdpbmRvd0VsZW1lbnQpLmluY2x1ZGVzKG9iailcbiAgKTtcbiAgcmV0dXJuIGlzV2luZG93O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9jdW1lbnRFbGVtZW50KFxuICBpc0NvbnRhaW5lcldpbmRvdzogYm9vbGVhbixcbiAgd2luZG93RWxlbWVudDogYW55XG4pIHtcbiAgcmV0dXJuIGlzQ29udGFpbmVyV2luZG93ID8gd2luZG93RWxlbWVudC5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgOiBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlUG9pbnRzKGVsZW1lbnQ6IEVsZW1lbnRSZWYsIHJlc29sdmVyOiBJUmVzb2x2ZXIpIHtcbiAgY29uc3QgaGVpZ2h0ID0gZXh0cmFjdEhlaWdodEZvckVsZW1lbnQocmVzb2x2ZXIpO1xuICByZXR1cm4gcmVzb2x2ZXIuaXNXaW5kb3dcbiAgICA/IGNhbGN1bGF0ZVBvaW50c0ZvcldpbmRvdyhoZWlnaHQsIGVsZW1lbnQsIHJlc29sdmVyKVxuICAgIDogY2FsY3VsYXRlUG9pbnRzRm9yRWxlbWVudChoZWlnaHQsIGVsZW1lbnQsIHJlc29sdmVyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVBvaW50c0ZvcldpbmRvdyhcbiAgaGVpZ2h0OiBudW1iZXIsXG4gIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gIHJlc29sdmVyOiBJUmVzb2x2ZXJcbik6IElQb3NpdGlvblN0YXRzIHtcbiAgY29uc3QgeyBheGlzLCBjb250YWluZXIsIGlzV2luZG93IH0gPSByZXNvbHZlcjtcbiAgY29uc3QgeyBvZmZzZXRIZWlnaHRLZXksIGNsaWVudEhlaWdodEtleSB9ID0gZXh0cmFjdEhlaWdodFByb3BLZXlzKGF4aXMpO1xuICAvLyBzY3JvbGxlZCB1bnRpbCBub3cgLyBjdXJyZW50IHkgcG9pbnRcbiAgY29uc3Qgc2Nyb2xsZWQgPVxuICAgIGhlaWdodCArXG4gICAgZ2V0RWxlbWVudFBhZ2VZT2Zmc2V0KFxuICAgICAgZ2V0RG9jdW1lbnRFbGVtZW50KGlzV2luZG93LCBjb250YWluZXIpLFxuICAgICAgYXhpcyxcbiAgICAgIGlzV2luZG93XG4gICAgKTtcbiAgLy8gdG90YWwgaGVpZ2h0IC8gbW9zdCBib3R0b20geSBwb2ludFxuICBjb25zdCBuYXRpdmVFbGVtZW50SGVpZ2h0ID0gZ2V0RWxlbWVudEhlaWdodChcbiAgICBlbGVtZW50Lm5hdGl2ZUVsZW1lbnQsXG4gICAgaXNXaW5kb3csXG4gICAgb2Zmc2V0SGVpZ2h0S2V5LFxuICAgIGNsaWVudEhlaWdodEtleVxuICApO1xuICBjb25zdCB0b3RhbFRvU2Nyb2xsID1cbiAgICBnZXRFbGVtZW50T2Zmc2V0VG9wKGVsZW1lbnQubmF0aXZlRWxlbWVudCwgYXhpcywgaXNXaW5kb3cpICtcbiAgICBuYXRpdmVFbGVtZW50SGVpZ2h0O1xuICByZXR1cm4geyBoZWlnaHQsIHNjcm9sbGVkLCB0b3RhbFRvU2Nyb2xsLCBpc1dpbmRvdyB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlUG9pbnRzRm9yRWxlbWVudChcbiAgaGVpZ2h0OiBudW1iZXIsXG4gIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gIHJlc29sdmVyOiBJUmVzb2x2ZXJcbik6IElQb3NpdGlvblN0YXRzIHtcbiAgY29uc3QgeyBheGlzLCBjb250YWluZXIgfSA9IHJlc29sdmVyO1xuICAvLyBwZXJoYXBzIHVzZSBjb250YWluZXIub2Zmc2V0VG9wIGluc3RlYWQgb2YgJ3Njcm9sbFRvcCdcbiAgY29uc3Qgc2Nyb2xsZWQgPSBjb250YWluZXJbYXhpcy5zY3JvbGxUb3BLZXkoKV07XG4gIGNvbnN0IHRvdGFsVG9TY3JvbGwgPSBjb250YWluZXJbYXhpcy5zY3JvbGxIZWlnaHRLZXkoKV07XG4gIHJldHVybiB7IGhlaWdodCwgc2Nyb2xsZWQsIHRvdGFsVG9TY3JvbGwsIGlzV2luZG93OiBmYWxzZSB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdEhlaWdodFByb3BLZXlzKGF4aXM6IEF4aXNSZXNvbHZlcikge1xuICByZXR1cm4ge1xuICAgIG9mZnNldEhlaWdodEtleTogYXhpcy5vZmZzZXRIZWlnaHRLZXkoKSxcbiAgICBjbGllbnRIZWlnaHRLZXk6IGF4aXMuY2xpZW50SGVpZ2h0S2V5KCksXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0SGVpZ2h0Rm9yRWxlbWVudCh7XG4gIGNvbnRhaW5lcixcbiAgaXNXaW5kb3csXG4gIGF4aXMsXG59OiBJUmVzb2x2ZXIpIHtcbiAgY29uc3QgeyBvZmZzZXRIZWlnaHRLZXksIGNsaWVudEhlaWdodEtleSB9ID0gZXh0cmFjdEhlaWdodFByb3BLZXlzKGF4aXMpO1xuICByZXR1cm4gZ2V0RWxlbWVudEhlaWdodChcbiAgICBjb250YWluZXIsXG4gICAgaXNXaW5kb3csXG4gICAgb2Zmc2V0SGVpZ2h0S2V5LFxuICAgIGNsaWVudEhlaWdodEtleVxuICApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRIZWlnaHQoXG4gIGVsZW06IGFueSxcbiAgaXNXaW5kb3c6IGJvb2xlYW4sXG4gIG9mZnNldEhlaWdodEtleTogc3RyaW5nLFxuICBjbGllbnRIZWlnaHRLZXk6IHN0cmluZ1xuKSB7XG4gIGlmIChpc05hTihlbGVtW29mZnNldEhlaWdodEtleV0pKSB7XG4gICAgY29uc3QgZG9jRWxlbSA9IGdldERvY3VtZW50RWxlbWVudChpc1dpbmRvdywgZWxlbSk7XG4gICAgcmV0dXJuIGRvY0VsZW0gPyBkb2NFbGVtW2NsaWVudEhlaWdodEtleV0gOiAwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBlbGVtW29mZnNldEhlaWdodEtleV07XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRPZmZzZXRUb3AoXG4gIGVsZW06IENvbnRhaW5lclJlZixcbiAgYXhpczogQXhpc1Jlc29sdmVyLFxuICBpc1dpbmRvdzogYm9vbGVhblxuKSB7XG4gIGNvbnN0IHRvcEtleSA9IGF4aXMudG9wS2V5KCk7XG4gIC8vIGVsZW0gPSBlbGVtLm5hdGl2ZUVsZW1lbnQ7XG4gIGlmICghZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QpIHtcbiAgICAvLyB8fCBlbGVtLmNzcygnbm9uZScpKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHJldHVybiAoXG4gICAgZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVt0b3BLZXldICtcbiAgICBnZXRFbGVtZW50UGFnZVlPZmZzZXQoZWxlbSwgYXhpcywgaXNXaW5kb3cpXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50UGFnZVlPZmZzZXQoXG4gIGVsZW06IENvbnRhaW5lclJlZixcbiAgYXhpczogQXhpc1Jlc29sdmVyLFxuICBpc1dpbmRvdzogYm9vbGVhblxuKSB7XG4gIGNvbnN0IHBhZ2VZT2Zmc2V0ID0gYXhpcy5wYWdlWU9mZnNldEtleSgpO1xuICBjb25zdCBzY3JvbGxUb3AgPSBheGlzLnNjcm9sbFRvcEtleSgpO1xuICBjb25zdCBvZmZzZXRUb3AgPSBheGlzLm9mZnNldFRvcEtleSgpO1xuXG4gIGlmIChpc05hTih3aW5kb3cucGFnZVlPZmZzZXQpKSB7XG4gICAgcmV0dXJuIGdldERvY3VtZW50RWxlbWVudChpc1dpbmRvdywgZWxlbSlbc2Nyb2xsVG9wXTtcbiAgfSBlbHNlIGlmIChlbGVtLm93bmVyRG9jdW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3W3BhZ2VZT2Zmc2V0XTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZWxlbVtvZmZzZXRUb3BdO1xuICB9XG59XG4iXX0=